const http=require("http"),fs=require("fs"),url=require("url"),qs=require("querystring"),EventEmitter=require("events");class Request{constructor(e,r){this.req=e,this.method=e.method,this.url=e.url,this.query=r.query}}class Response{constructor(e){this.res=e,this.buffer=""}append(e){this.buffer+=e}send(){this.res.end(this.buffer)}setHeader(e,r){this.res.setHeader(e,r)}}class Avayay extends EventEmitter{constructor(){super(),this.server=null,this.controllers={},this.views={}}addController(e,r){if(!((r=new r)instanceof Controller))throw new Error("The Given Class Should be Instance of Controller");if(this.emit("ControllerAdded",r),null!=this.controllers[e])if(this.controller[e]instanceof Array)this.controllers[e].push(new r);else{const t=this.controllers[e];this.controllers[e]=[],this.controllers[e].push(t),this.controllers[e].push(new r)}else this.controllers[e]=r}start(e=80){return this.port=e,this.server=http.createServer((e,r)=>{const t=url.parse(e.url,!0);t.post={};const s=this.controllers[t.pathname],o=e.method;if("POST"==o){var n="";e.on("data",function(e){n+=e}),e.on("end",function(){t.post=qs.parse(n)})}if(null!=s){console.log(`Controller: ${t.pathname}`);const n=new Request(e,t),l=new Response(r);s[o.toLowerCase()](n,l)}else r.end("<h1>404: No Such Controller :( </h1>")}).listen(this.port,"0.0.0.0"),this.emit("ServerStarted",this.server),Promise.resolve(this.server)}}module.exports=Avayay;