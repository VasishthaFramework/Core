const http=require("http"),fs=require("fs"),url=require("url"),EventEmitter=require("events");class Request{constructor(e,t){this.req=e,this.method=e.method,this.url=e.url,this.query=t.query}}class Response{constructor(e){this.res=e,this.buffer=""}append(e){this.buffer+=e}send(){this.res.end(this.buffer)}setHeader(e,t){this.res.setHeader(e,t)}}class Avayay extends EventEmitter{constructor(){super(),this.server=null,this.controllers={},this.views={}}addController(e,t){if(!((t=new t)instanceof Controller))throw new Error("The Given Class Should be Instance of Controller");if(this.emit("ControllerAdded",t),null!=this.controllers[e])if(this.controller[e]instanceof Array)this.controllers[e].push(new t);else{const r=this.controllers[e];this.controllers[e]=[],this.controllers[e].push(r),this.controllers[e].push(new t)}else this.controllers[e]=t}start(e=80){return this.port=e,this.server=http.createServer((e,t)=>{const r=url.parse(e.url,!0);r.post={};const s=this.controllers[r.pathname],o=e.method;if("POST"==o){var n="";e.on("data",function(e){n+=e}),e.on("end",function(){r.post=qs.parse(n)})}if(null!=s){console.log(`Controller: ${r.pathname}`);const n=new Request(e,r),l=new Response(t);s[o.toLowerCase()](n,l)}else t.end("<h1>404: No Such Controller :( </h1>")}).listen(this.port,"0.0.0.0"),this.emit("ServerStarted",this.server),Promise.resolve(this.server)}}module.exports=Avayay;